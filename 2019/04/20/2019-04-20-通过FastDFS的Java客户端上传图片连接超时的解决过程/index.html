<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Java åç«¯">
    <meta name="description" content="å°æ©˜å­ğŸŠçš„ä¸ªäººä¸»é¡µï¼Œæ¬¢è¿è®¿é—®~~">
    <meta name="author" content="å°æ©˜å­ğŸŠ">
    
    <title>
        
            é€šè¿‡FastDFSçš„Javaå®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡è¿æ¥è¶…æ—¶çš„è§£å†³è¿‡ç¨‹ |
        
        AprilYoLies
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="https://img.aprilyolies.top/img/typora/avatar.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"aprilyolies.top","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"https://img.aprilyolies.top/img/typora/avatar.jpg","favicon":"https://img.aprilyolies.top/img/typora/avatar.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"å¹²ç‡¥çš„ç©ºæ°”ï¼Œå°˜åŸƒçš„å‘³é“ï¼Œæˆ‘åœ¨å…¶ä¸­â€¦è¸ä¸Šæ—…é€”ï¼"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://img.aprilyolies.top/img/typora/avatar.jpg">
                </a>
            
            <a class="logo-title" href="/">
                AprilYoLies
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">é€šè¿‡FastDFSçš„Javaå®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡è¿æ¥è¶…æ—¶çš„è§£å†³è¿‡ç¨‹</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://img.aprilyolies.top/img/typora/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">å°æ©˜å­ğŸŠ</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2019-04-20 20:38:48</span>
        <span class="mobile">2019-04-20 20:38</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">åç«¯å¼€å‘</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/FastDFS/">FastDFS</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Java/">Java</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- toc -->

<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ <a href="#">Post not found: FastDFSå•æœºç¯å¢ƒä¸‹çš„æ­å»º FastDFSå•æœºç¯å¢ƒä¸‹çš„æ­å»º</a> è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æ­å»ºäº†ä¸€ä¸ª FastDFS å›¾ç‰‡æœåŠ¡å™¨ï¼Œè¿™é‡Œæˆ‘é€šè¿‡FastDFSæä¾›çš„å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œæ–‡ä»¶ä¸Šä¼ æ˜¯æˆåŠŸçš„ï¼Œç„¶åå°±æ˜¯æµ‹è¯•ä¸€ä¸‹é€šè¿‡Javaå®¢æˆ·ç«¯æ¥è¿›è¡Œå›¾ç‰‡çš„ä¸Šä¼ æ“ä½œï¼Œå¾ˆé—æ†¾æµ‹è¯•æ²¡æœ‰é€šè¿‡ï¼Œæ§åˆ¶å°æ‰“å°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">java.net.SocketTimeoutException: connect timed out</span><br><span class="line"></span><br><span class="line">	at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:<span class="number">350</span>)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:<span class="number">206</span>)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:<span class="number">188</span>)</span><br><span class="line">	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:<span class="number">392</span>)</span><br><span class="line">	at java.net.Socket.connect(Socket.java:<span class="number">589</span>)</span><br><span class="line">	at org.csource.fastdfs.ClientGlobal.getSocket(ClientGlobal.java:<span class="number">208</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageServer.&lt;init&gt;(StorageServer.java:<span class="number">43</span>)</span><br><span class="line">	at org.csource.fastdfs.TrackerClient.getStoreStorage(TrackerClient.java:<span class="number">144</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient.newWritableStorageConnection(StorageClient.java:<span class="number">1627</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient.do_upload_file(StorageClient.java:<span class="number">639</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient.upload_file(StorageClient.java:<span class="number">120</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient.upload_file(StorageClient.java:<span class="number">91</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient.upload_file(StorageClient.java:<span class="number">73</span>)</span><br><span class="line">	at org.csource.fastdfs.StorageClient1.upload_file1(StorageClient1.java:<span class="number">64</span>)</span><br><span class="line">	at com.eva.utils.FastDFSClient.uploadFile(FastDFSClient.java:<span class="number">36</span>)</span><br><span class="line">	at com.eva.utils.FastDFSClient.uploadFile(FastDFSClient.java:<span class="number">41</span>)</span><br><span class="line">	at com.eva.fastdfs.TestFastDFS.testFastDfsClient(TestFastDFS.java:<span class="number">34</span>)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod$<span class="number">1.</span>runReflectiveCall(FrameworkMethod.java:<span class="number">50</span>)</span><br><span class="line">	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:<span class="number">12</span>)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:<span class="number">47</span>)</span><br><span class="line">	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:<span class="number">17</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:<span class="number">325</span>)</span><br><span class="line">	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class="number">78</span>)</span><br><span class="line">	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class="number">57</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">3.</span>run(ParentRunner.java:<span class="number">290</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">1.</span>schedule(ParentRunner.java:<span class="number">71</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:<span class="number">288</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.access$<span class="number">000</span>(ParentRunner.java:<span class="number">58</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">2.</span>evaluate(ParentRunner.java:<span class="number">268</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.run(ParentRunner.java:<span class="number">363</span>)</span><br><span class="line">	at org.junit.runner.JUnitCore.run(JUnitCore.java:<span class="number">137</span>)</span><br><span class="line">	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:<span class="number">68</span>)</span><br><span class="line">	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:<span class="number">47</span>)</span><br><span class="line">	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:<span class="number">242</span>)</span><br><span class="line">	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:<span class="number">70</span>)</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><blockquote>
<p>æˆ‘çš„ FastDFS æ­å»ºåœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šï¼Œå…¬ç½‘IPåœ°å€ä¸º 119.23.247.86ã€‚</p>
</blockquote>
<p>é€šè¿‡æ‰“å°çš„ stack dump ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆæŠ¥é”™ç‚¹æ˜¯ä¸ªnativeæ–¹æ³•ï¼Œnativeæ–¹æ³•å¯¹äºæˆ‘æ¥è¯´å°±æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘åªèƒ½æ˜¯è·Ÿè¸ªä»–çš„ä¸Šä¸€çº§è°ƒç”¨ï¼Œé€šè¿‡æ‰“ä¸€ä¸ªæ–­ç‚¹è¿›è¡Œè°ƒè¯•å¯ä»¥çœ‹åˆ°æ­¤æ–¹æ³•ä¸º java.net.AbstractPlainSocketImpl.socketConnect(address, port, timeout)ï¼Œå®ƒæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå½“å‰è°ƒè¯•çš„å€¼å¦‚ä¸‹å›¾ï¼š</p>
<blockquote>
<p>java.net.AbstractPlainSocketImpl</p>
</blockquote>
<p><img src="https://img.aprilyolies.top/img/typora/tracker-port.jpeg" alt="tracker-port"></p>
<p>å¯ä»¥çœ‹åˆ°å½“å‰çš„ç«¯å£ä¸º 22122 ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå°†è¦è¿æ¥ Tracker æœåŠ¡å™¨ï¼Œè²Œä¼¼æ²¡å•¥é—®é¢˜å•Šï¼Ÿé‚£å°±ç›´æ¥ä¸‹ä¸€æ­¥ï¼Œå‘ç°è¢«è°ƒç”¨çš„ native æ–¹æ³•å¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”é¡ºåˆ©çš„æ‰§è¡Œåˆ°äº† java.net.AbstractPlainSocketImpl.socketConnect(address, port, timeout) çš„ä¸‹ä¸€è¡Œï¼Œæ§åˆ¶å°ä¹Ÿæ²¡æœ‰ä»»ä½•å¼‚å¸¸ä¿¡æ¯ï¼Œç°è±¡å¦‚ä¸‹å›¾ï¼š</p>
<blockquote>
<p>java.net.AbstractPlainSocketImpl</p>
</blockquote>
<p><img src="https://img.aprilyolies.top/img/typora/tracker-ok.jpeg" alt="tracker-ok"></p>
<p>è¿™å°±è¯´æ˜å¹¶ä¸æ˜¯Javaå®¢æˆ·ç«¯å’Œtrackerå»ºç«‹è¿æ¥å‘ç”Ÿé”™è¯¯ï¼Œäºæ˜¯å…¨é€Ÿæ‰§è¡Œï¼Œå‘ç°ä»£ç åˆé‡æ–°çš„åœåœ¨äº† java.net.AbstractPlainSocketImpl.socketConnect(address, port, timeout) å¤„ï¼Œç°è±¡å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>java.net.AbstractPlainSocketImpl</p>
</blockquote>
<p><img src="https://img.aprilyolies.top/img/typora/storage-port.jpeg" alt="storage-port"></p>
<p><strong>æ³¨æ„äº†ï¼ï¼</strong> address å˜æˆäº† 172.17.45.253ï¼Œè¿™ä¸ªå€¼æ€ä¹ˆè·Ÿè·Ÿæˆ‘çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘åœ°å€ä¸ä¸€æ ·å‘¢ï¼Ÿå¦å¤– port å˜æˆäº† 23000 è¿™å°±è¯´æ˜å½“å‰æ˜¯åœ¨ä¸ storage è¿›è¡Œè¿æ¥ï¼Œå…ˆä¸ç®¡é‚£ä¹ˆå¤šï¼Œç›´æ¥ä¸‹ä¸€æ­¥çœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡å§ï¼Œç°è±¡å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>java.net.AbstractPlainSocketImpl</p>
</blockquote>
<p><img src="https://img.aprilyolies.top/img/typora/storage-fail.jpeg" alt="storage-fail"></p>
<p>å¯ä»¥çœ‹åˆ°ä»£ç æ˜¯ç›´æ¥è·³åˆ°äº† finally ä»£ç å—ï¼Œè¿™å°±è¯´æ˜åœ¨ native æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å¯ä»¥æ¨æ–­ï¼Œport æ˜¯ä¹ˆæœ‰é—®é¢˜çš„ï¼Œå”¯ä¸€çš„å¯èƒ½å°±æ˜¯ address ï¼Œæ¯•ç«Ÿä»–ç«Ÿç„¶ä¸æ˜¯æˆ‘çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘åœ°å€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªåœ°å€å‘¢ï¼Ÿåœ¨æˆ‘çš„ .properties ç­‰ç›¸å…³é…ç½®æ–‡ä»¶ä¸­ï¼Œéƒ½æ²¡æœ‰å‡ºç°è¿‡è¿™ä¸ªå¯ç–‘çš„ ip åœ°å€ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±æ˜¯æ¥æ’æŸ¥è¿™ä¸ªå¯ç–‘çš„ ip åœ°å€çš„æ¥æºäº†ã€‚</p>
<p>é€šè¿‡ debug è¿‡ç¨‹çš„ stack dump ä¿¡æ¯ï¼Œè¿›è¡Œå¾€ä¸‹è·Ÿè¸ªï¼ˆæ¯•ç«Ÿæ˜¯ä¸ªæ–¹æ³•æ ˆå˜›~~ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯ç–‘çš„ ip åœ°å€æ˜¯é€šè¿‡ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.csource.fastdfs.TrackerClient#getStoreStorage(org.csource.fastdfs.TrackerServer, java.lang.String) </span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip_addr = <span class="keyword">new</span> <span class="title class_">String</span>(pkgInfo.body, ProtoCommon.FDFS_GROUP_NAME_MAX_LEN, ProtoCommon.FDFS_IPADDR_SIZE - <span class="number">1</span>).trim();</span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œä»£ç æ„é€ å‡ºæ¥çš„ï¼Œé‡Œè¾¹çš„å…³é”®å‚æ•°å°±æ˜¯ pkgInfo.bodyï¼Œè¿™ä¸ªå‚æ•°æ˜¯é€šè¿‡å½“å‰æ–¹æ³•çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProtoCommon.<span class="type">RecvPackageInfo</span> <span class="variable">pkgInfo</span> <span class="operator">=</span> ProtoCommon.recvPackage(trackerSocket.getInputStream(), ProtoCommon.TRACKER_PROTO_CMD_RESP, ProtoCommon.TRACKER_QUERY_STORAGE_STORE_BODY_LEN);</span><br></pre></td></tr></table></figure>

<p>æ„å»ºçš„ï¼Œè¿™é‡Œçš„ trackerSocket.getInputStream() æ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯ä» trackerSocket ä¸­è·å–çš„ï¼Œäºæ˜¯çŒœæµ‹å¯ç–‘ ip å°±æ˜¯é€šè¿‡ tracker æœåŠ¡å™¨ä¼ è¾“è¿‡æ¥çš„ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æ·±å…¥è¿™è¡Œä»£ç ï¼Œæ¢ç©¶å…·ä½“çš„æ¥æ”¶è¿‡ç¨‹ï¼Œè¯¦ç»†çš„æ“ä½œåœ¨ä¸‹è¾¹è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> RecvPackageInfo <span class="title function_">recvPackage</span><span class="params">(InputStream in, <span class="type">byte</span> expect_cmd, <span class="type">long</span> expect_body_len)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// è¾“å…¥æµä¸­æ•°æ®çš„</span></span><br><span class="line">    <span class="type">RecvHeaderInfo</span> <span class="variable">header</span> <span class="operator">=</span> recvHeader(in, expect_cmd, expect_body_len);</span><br><span class="line">    <span class="keyword">if</span> (header.errno != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RecvPackageInfo</span>(header.errno, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨æ•°æ®æµä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="type">byte</span>[] body = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) header.body_len];</span><br><span class="line">    <span class="type">int</span> <span class="variable">totalBytes</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">remainBytes</span> <span class="operator">=</span> (<span class="type">int</span>) header.body_len;</span><br><span class="line">    <span class="type">int</span> bytes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (totalBytes &lt; header.body_len) &#123;</span><br><span class="line">      <span class="comment">// å°†æµä¸­çš„æ•°æ®è¯»å…¥åˆ°bobyä¸­</span></span><br><span class="line">      <span class="keyword">if</span> ((bytes = in.read(body, totalBytes, remainBytes)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      totalBytes += bytes;</span><br><span class="line">      remainBytes -= bytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (totalBytes != header.body_len) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;recv package size &quot;</span> + totalBytes + <span class="string">&quot; != &quot;</span> + header.body_len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†bodyå°è£…æˆRecvPackageInfo</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RecvPackageInfo</span>((<span class="type">byte</span>) <span class="number">0</span>, body);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›åå°±æ˜¯é€šè¿‡ RecvPackageInfo æ¥æ„é€ è¿™ä¸ªå¯ç–‘çš„ storage çš„ ip åœ°å€äº†ã€‚</p>
<p>æ—¢ç„¶å¯ç–‘çš„ ip åœ°å€æ¥è‡ª trackerSockt çš„è¾“å…¥æµï¼Œä¸ºä»€ä¹ˆ tracker ä¼šè¿”å›è¿™ä¸ª ip åœ°å€å‘¢ï¼Ÿç«‹å³è”æƒ³åˆ°è¿™ä¸ª ip å¯èƒ½æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨çš„å†…ç½‘åœ°å€ï¼Œäºæ˜¯è¿›è¡ŒæŸ¥çœ‹ï¼Œä¸æ‰€æƒ³ä¸€æ ·ï¼Œé‚£ä¹ˆç°åœ¨å¯ä»¥å°†é—®é¢˜ç¼©å°åˆ° tracker è¯¯å°†æœåŠ¡å™¨çš„å†…ç½‘åœ°å€å½“å…¬ç½‘åœ°å€è¿”å›ç»™å®¢æˆ·ç«¯äº†ï¼Œäºæ˜¯æ ¸éªŒ tracker å’Œ storage é…ç½®æ–‡ä»¶ï¼Œæœç„¶æ˜¯è‡ªå·±åœ¨è¿›è¡Œé…ç½®æ—¶ï¼Œè¯¯å°†å†…ç½‘åœ°å€å¡«å†™ä¸ºäº†å…¬ç½‘åœ°å€ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>tcpã€ipã€udp ç›¸å…³çš„çŸ¥è¯†åˆæ·¡å¿˜äº†ï¼ŒæŠ½ç©ºå¤ä¹ ä¸€ä¸‹ tcp æ‹¥å¡æ§åˆ¶ã€æ…¢å¯åŠ¨ç›¸å…³çš„å†…å®¹ã€‚</li>
<li>è¿™é‡Œçš„å…¬ç½‘ ipã€å†…ç½‘ ip å•¥æ„æ€å‘¢ï¼Ÿç±»ä¼¼äºè™šæ‹Ÿæœºé€šè¿‡ nat ç»„ç½‘çš„é‚£ç§æ¨¡å¼å—ï¼Ÿå®¿ä¸»æœºçš„ ip åœ°å€å°±æ˜¯å…¬ç½‘ipï¼Œå’Œè™šæ‹Ÿæœºç›¸è¿çš„é‚£å—è™šæ‹Ÿç½‘å¡åˆ†é…çš„ ip ä¸ºå†…ç½‘ ipï¼Ÿ</li>
</ul>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/FastDFS/">#FastDFS</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Java/">#Java</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2019/04/24/2019-04-24-Git%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E6%80%BB%E7%BB%93/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Gitå¸¸ç”¨æŒ‡ä»¤æ€»ç»“</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2019/04/20/2019-04-20-Java%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%B1%87%E6%80%BB/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Javaå¼€å‘å¸¸ç”¨å·¥å…·ç±»æ±‡æ€»</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">å°æ©˜å­ğŸŠ</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-text">é—®é¢˜æè¿°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-text">é—®é¢˜åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">æ€»ç»“</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
